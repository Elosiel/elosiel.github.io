(this["webpackJsonpmaven-m2m"]=this["webpackJsonpmaven-m2m"]||[]).push([[0],{111:function(e,t,n){"use strict";var r=n(22),o=n(33),a=n(31),i=n(29),s=n(28),c=n(30),l=n(25),u=n(0),m=n.n(u),d=n(76),p=n(5),h=n(102),f=n.n(h),v=n(196),g=n(197),b=n(162),y=n(47),O=n.n(y),w=n(201),E=n(199),j=n(110),S=n.n(j),P=n(57),k=n(81),C=n(41),x=n(48),N=n(49),M=n(7),I=n(93);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=500,R=3,D={View:"View",Navigate:"Navigate",Preview:"Preview",WidgetLoaded:"WidgetLoaded",WidgetOpened:"WidgetOpened",WidgetClosed:"WidgetClosed",WidgetHidden:"WidgetHidden",WidgetHeightChanged:"WidgetHeightChanged"},T={referrerUrl:document.location.href,referrerChannelKey:M.b.referrerChannelKey,referrerRoomKey:M.b.referrerRoomKey,referrerConversationId:M.b.referrerConversationId,deviceId:M.b.uid,component:["m2m"]},K=[];function U(e){if(e=_({sessionKey:M.b.sessionKey},T,{},e),M.b.logEvent(e),e.type!==D.Navigate)return K.push(e),void M.b.scheduler.schedule({key:"userEventsBuffer",task:H,delay:5,delayUnits:C.Scheduler.TimeUnit.FRAME});var t=JSON.stringify(e);navigator.sendBeacon?navigator.sendBeacon(M.f+"/api/userEvent",t):fetch("".concat(M.f,"/api/userEvent"),{method:"post",body:t})}function H(){var e=JSON.stringify({events:K});navigator.sendBeacon?navigator.sendBeacon(M.f+"/api/userEvent/batchObject",e):fetch("".concat(M.f,"/api/userEvent/batchObject"),{method:"post",body:e}),K=[]}function L(e){if(e){if(e.includes("_100.jpg"))return e.replace("_100.jpg","_f1024.jpg");if(e.includes("_f496.jpg"))return e.replace("_f496.jpg","_f1024.jpg");if(!(e=e.replace(/ /g,"-")).includes(".image"))return e;var t=new URL(e),n=t.pathname.split("/");if(n[R].includes("."))return e;var r=n[R];return t.pathname="/.image/".concat(r,"/title.jpg"),t.href}console.warn("no photo")}var B=function(e){var t=e.brief,n=e.containerOpen,r=e.conversationId,o=e.classes,a=e.slimMode;if(t||(t=f()("".concat(M.f,"/api/conversation/").concat(r,"/_brief"))),t.stackTrace)return null;!function(e){e.extensions?(e.imageUrl=e.extensions[0].story.photo,e.subtitle=e.channelDisplayName,e.url=e.tempestUrl||e.url,e.source="salish"):e.author&&(e.subtitle=e.author,e.imageUrl=e.thumbnail,e.source="liftigniter")}(t);var i={component:["m2m",t.source],channelKey:t.channelKey,roomKey:t.roomKey,conversationId:t.id,viewType:"m2m - large card",targetUrl:t.tempestUrl||t.url},s=function(){return n&&U(_({type:D.Preview},i))};return m.a.createElement(v.a,{square:!0,className:a?o.smallCard:o.card},m.a.createElement("div",{ref:function(e){return e&&x.b.addObservable(e,s)}},m.a.createElement(g.a,{href:t.tempestUrl||t.url,onClick:function(){return U(_({type:D.Navigate},i))}},m.a.createElement("div",{className:a?o.smallCardContainer:null},m.a.createElement(N.a,{width:a?92:M.a,height:a?92:152,imageProxyOrigin:M.c,url:L(t.imageUrl),preload:!1}),m.a.createElement(b.a,{className:a?o.smallCardItem:o.content},m.a.createElement(O.a,{color:"textSecondary",variant:"overline"},a?m.a.createElement(d.a,{lines:1},t.subtitle):m.a.createElement(m.a.Fragment,null,t.subtitle)),m.a.createElement(O.a,{variant:"subtitle1",component:"h4"},a?m.a.createElement(d.a,{lines:3},t.title):m.a.createElement(m.a.Fragment,null,t.title)))))))},A=function(e){return m.a.createElement(u.Suspense,{fallback:m.a.createElement(k.b,null)},m.a.createElement(B,e))},z=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(a.a)(this,Object(i.a)(t).call(this,e))).state={open:!1},n.onScroll=function(){var e=n.props.scrollElement.scrollY;if(n.state.keepClosed)n.lastScroll=e;else{if(!n.state.observeNodeObserved&&n.state.open&&e>n.lastScroll)return n.closeNoEvent(),void(n.lastScroll=e);if(!n.state.open&&e<n.lastScroll){if(n.lastScroll-e<F)return;if(n.lastScroll=e,n.state.timesShown>=M.b.maxShowTimes)return void console.log("m2m widget has already been shown ".concat(n.state.timesShown,". Leaving closed."));n.open()}else n.lastScroll=e}},n.close=function(e){(e.constructor!==MouseEvent||document.body.contains(e.srcElement))&&n.closeNoEvent()},n.closeAndKeepClosed=function(){n.customEvent(D.WidgetClosed),n.setState({open:!1,keepClosed:!0})},n.open=function(){n.state.keepClosed||(n.customEvent(D.WidgetOpened),n.state.keepClosed||n.setState({open:!0,timesShown:n.state.timesShown+1}))};var o=e.scrollElement;return n.lastScroll=o.scrollY,n.state={open:!1,observeNodeObserved:!1,timesShown:0,slimMode:n.slimMode},window.addEventListener("resize",n.checkForShorterViewPort.bind(Object(s.a)(n))),e.scrollElement.addEventListener("scroll",(function(){return M.b.scheduler.schedule({key:"m2m-scheduler",task:function(){return n.onScroll()}})}),!1),n}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;M.b.nodeToObserveForDisplay&&x.b.addObservable(M.b.nodeToObserveForDisplay,(function(){e.setState({observeNodeObserved:!0}),e.open()})),this.customEvent(D.WidgetLoaded)}},{key:"componentDidUpdate",value:function(e,t,n){t.open===this.state.open&&t.slimMode===this.state.slimMode||this.maybePushFooterQuery()}},{key:"customEvent",value:function(e){U({type:e,widgetHeight:this.widgetHeight})}},{key:"checkForShorterViewPort",value:function(){this.setState({slimMode:this.slimMode})}},{key:"closeNoEvent",value:function(){this.setState({open:!1}),this.customEvent(D.WidgetHidden)}},{key:"maybePushFooterQuery",value:function(){var e=this;M.b.pushFooterQuery&&(document.querySelectorAll(M.b.pushFooterQuery).forEach((function(t){return t.style.transform="translateY(-".concat(e.widgetHeight,"px)")})),this.customEvent(D.WidgetHeightChanged))}},{key:"render",value:function(){var e=this,t=this.props,n=t.itemMap,r=t.conversationIds,o=t.classes,a=this.state.open;return m.a.createElement(E.a,{onClickAway:this.close},m.a.createElement(w.a,{variant:"persistent",onClose:this.close,onOpen:this.open,anchor:"bottom",open:a,classes:{paper:o.paper}},m.a.createElement("div",{className:"".concat(o.container," ").concat(o.root),ref:function(t){return e.element=t}},m.a.createElement(k.a,{slimMode:this.state.slimMode,title:m.a.createElement(m.a.Fragment,null,m.a.createElement(P.MavenKey,null)," ",this.state.slimMode?"Maven":"".concat("Maven"," Recommends")),maxWidth:r.length*(M.a+15)+8+"px",BriefCard:function(t){return m.a.createElement(A,Object.assign({},t,{slimMode:e.state.slimMode,containerOpen:a,classes:o,brief:n&&n.has(t.conversationId)?n.get(t.conversationId):null}))},conversations:r.slice(0,5),buttons:[m.a.createElement(S.a,{className:this.state.slimMode?o.closeButton:null,color:"inherit",size:this.state.slimMode?"small":"medium",onClick:this.closeAndKeepClosed},m.a.createElement(P.Close,null))]}))))}},{key:"slimMode",get:function(){return window.innerHeight<1100}},{key:"widgetHeight",get:function(){return this.state.open&&this.element?this.element.offsetHeight:0}}]),t}(u.Component);z.defaultProps={scrollElement:window};t.a=Object(I.a)(Object(p.a)((function(e){return{root:{boxSizing:"border-box",display:"block","& *":{boxSizing:"border-box"}},paper:{background:e.palette.grey[100],overflowY:"inherit"},container:{fontFamily:e.txt.defaultFont,maxWidth:"100vw",margin:"0 auto",position:"relative","& h3":{alignItems:"center",display:"flex",fontFamily:e.txt.defaultFont,fontSize:"14px"}},closeButton:{position:"absolute",top:"0",left:"50%",transform:"translate(-50%, 0)"},card:{width:M.a,height:250,"& h4":{maxHeight:"3em",overflow:"hidden"}},smallCard:{width:M.a,height:116,padding:e.gutter.medium,"& h4, & h4 span":{letterSpacing:"inherit"}},smallCardContainer:{display:"flex"},smallCardItem:{flex:"1",padding:"0",paddingLeft:e.gutter.medium,"&:last-child":{paddingBottom:0}},content:{paddingTop:e.gutter.small}}}))(z))},119:function(e,t,n){e.exports=n(120)},120:function(e,t,n){"use strict";n.r(t),function(e){var t=n(51),r=n.n(t),o=n(25),a=n(75),i=n(32),s=(n(122),n(7)),c=n(0),l=n.n(c),u=n(8),m=n.n(u),d=n(111);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=5;function v(e,t){var n,r=e.liftIgniterRecommendations&&new Map(e.liftIgniterRecommendations.map((function(e){return[e.url,e]})));if(void 0!==t.liToSalishRatio&&r){n=[];for(var o=0;o<f;o++)(Math.random()<=t.liToSalishRatio||!e.documents.length)&&e.liftIgniterRecommendations.length?n.push(e.liftIgniterRecommendations.shift().url):e.documents.length&&n.push(e.documents.shift().conversationId)}else!t["li-render"]&&e.documents&&e.documents.length?n=e.documents.map((function(e){return e.conversationId})):!n&&e.liftIgniterRecommendations&&(n=Object(i.a)(r.keys()));return{conversationIds:n,itemMap:r}}function g(e,t){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(r.a.mark((function e(t,n){var o,a,i,c,u,p,h,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=3;break;case 3:return o="stream/_brief",a=new URLSearchParams,i="m2m-request-count",c=~~sessionStorage[i],n.channels&&a.set("channels",JSON.stringify(n.channels)),n.uid&&c>0&&a.set("deviceId",n.uid),n.mlt&&"www.si.com"!==document.location.hostname&&a.set("mlt",JSON.stringify(n.mlt)),n["li-siteName"]&&a.set("liSiteName",n["li-siteName"]),n.recommend&&(o="recommend",a.set("url",encodeURIComponent(n.url||document.location.href))),a.set("boostPathWeight",n.boostPathWeight),a.set("hasImage","true"),e.next=16,fetch("".concat(s.f,"/api/").concat(o,"?").concat(a.toString())).then((function(e){return e.json()}));case 16:u=e.sent,sessionStorage[i]=c+1,p=v(u,n),h=p.conversationIds,f=p.itemMap,m.a.render(l.a.createElement(d.a,{itemMap:f,conversationIds:h}),t);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return O.apply(this,arguments)}function O(){return(O=Object(a.a)(r.a.mark((function e(t){var o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(3).then(n.bind(null,166));case 2:o=e.sent.default,m.a.render(l.a.createElement(o,null),t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=h({},s.b,{},e),n=t.element||document.createElement("div");switch(t.sessionKey=t.sessionKey||Object(s.d)(22),t.hostElement&&"object"===typeof t.hostElement&&1===t.hostElement.nodeType?t.hostElement.append(n):document.body.append(n),s.e.get("show")){case"streamLoader":y(n,t);break;default:g(n,t)}};e.mvn=e.mvn||{},(e.mvn.recommendQ||[]).forEach((function(e){return w(e)})),e.mvn.recommendQ={push:w},s.b.version||w()}.call(this,n(40))},122:function(e,t,n){(function(e){e.__CLIENT__=!0}).call(this,n(40))},7:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return d})),n.d(t,"f",(function(){return p})),n.d(t,"c",(function(){return h}));var r=n(25),o=n(41);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var i=270,s=function(e){return[0,1,3].reduce((function(e){return e+Math.random().toString(36).substr(2)}),"").substring(0,e)},c=new URLSearchParams(document.location.search),l={};c.forEach((function(e,t){if(t.startsWith("m2m")){t=t.replace(/^m2m-/,"");try{l[t]=JSON.parse(e)}catch(n){l[t]=e}}}));var u=document.querySelector("meta[property='og:site_name']"),m=u&&u.getAttribute("content"),d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(n,!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({uid:void 0,mlt:void 0,logEvent:function(e){return console.warn("no event logger defined. do you want to add one?",e)},pushFooterQuery:".m-fixedbottom-ad--slot",nodeToObserveForDisplay:void 0,boostPathWeight:10,minWindowHeightToShow:788,maxShowTimes:3,liToSalishRatio:void 0,recommend:!0,scheduler:new o.Scheduler,"li-siteName":m},e.mvn,{},l),p=d.serverOrigin||"https://maven.io",h="https://imageproxy.themaven.net";if(!p)throw new Error("REACT_APP_SERVER_ORIGIN env var is not set");e.__webpack_public_path__="https://ben.maven.io/m2m"}).call(this,n(40))},93:function(e,t,n){"use strict";var r=n(32),o=n(0),a=n.n(o),i=n(94),s=n(107),c=n(10),l=n(65),u=n(64),m=n(77),d=n(7),p=n(106),h=Object(c.c)({plugins:[Object(s.a)()].concat(Object(r.a)(Object(l.a)().plugins))}),f=Object(i.mavenBaseTheme)({typography:{htmlFontSize:d.b.htmlFontSize}}),v=Object(u.a)({productionPrefix:"m2m"});t.a=function(e){return function(t){return a.a.createElement(m.b,{jss:h,classNamePrefix:"m2m",generateClassName:v},a.a.createElement(p.a,{theme:f},a.a.createElement(e,t)))}}}},[[119,1,2]]]);
//# sourceMappingURL=main.d8997826.chunk.js.map